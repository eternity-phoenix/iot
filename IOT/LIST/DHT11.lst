C51 COMPILER V9.52.0.0   DHT11                                                             06/02/2016 17:59:18 PAGE 1   


C51 COMPILER V9.52.0.0, COMPILATION OF MODULE DHT11
OBJECT MODULE PLACED IN .\DHT11.obj
COMPILER INVOKED BY: d:\Keil\C51\BIN\C51.EXE ..\DHT11\DHT11.c BROWSE INCDIR(..\UART;..\DHT11;..\ESP8266;..\MAIN) DEBUG O
                    -BJECTEXTEND PRINT(.\DHT11.lst) TABS(2) OBJECT(.\DHT11.obj)

line level    source

   1          //硬件连接： P2.0口为通讯口连接DHT1
   2          #include <reg52.h>
   3          #include "DHT11.h"
   4          
   5          #define uchar unsigned char
   6          #define uint unsigned int
   7          
   8          sbit DHT11_DATA = P0^0;
   9          
  10          uchar FLAG;
  11          uchar T_data_H, T_data_L, RH_data_H, RH_data_L, checkdata;
  12          uchar T_data_H_temp, T_data_L_temp, RH_data_H_temp, RH_data_L_temp, checkdata_temp;
  13          uchar DATA_TEMP; 
  14          
  15          void Delay_100us(uint j)
  16          {   
  17   1        uchar i;
  18   1        for(; j > 0; j--){  
  19   2          for(i = 0; i < 27; i++); 
  20   2        }
  21   1      }
  22          
  23          void  Delay_10us(void)
  24          {
  25   1        uchar i;
  26   1        i--;
  27   1        i--;
  28   1        i--;
  29   1        i--;
  30   1        i--;
  31   1        i--;
  32   1      }
  33          //串行总线  
  34          void DHT11_ReadValue(void)
  35          {
  36   1        uchar i, value;
  37   1        for(i = 0; i < 8; i++){
  38   2          FLAG = 2;
  39   2          while((!DHT11_DATA) && FLAG++);
  40   2          Delay_10us();
  41   2          Delay_10us();
  42   2          value=0;
  43   2          if(DHT11_DATA){
  44   3            value++;
  45   3          }
  46   2          FLAG = 2;
  47   2          while(DHT11_DATA && FLAG++);
  48   2          //超时则跳出for循环    
  49   2          if(FLAG == 1){
  50   3            break;
  51   3          }
  52   2          //判断数据位是0还是1  
  53   2          // 如果高电平高过预定0高电平值则数据位为 1 
  54   2          DATA_TEMP <<= 1;
C51 COMPILER V9.52.0.0   DHT11                                                             06/02/2016 17:59:18 PAGE 2   

  55   2          DATA_TEMP |= value;
  56   2        }
  57   1      }
  58          
  59           //--------------------------------
  60           //-----湿度读取子程序 ------------
  61           //--------------------------------
  62           //----以下变量均为全局变量--------
  63           //----温度高8位== T_data_H------
  64           //----温度低8位== T_data_L------
  65           //----湿度高8位== RH_data_H-----
  66           //----湿度低8位== RH_data_L-----
  67           //----校验 8位 == checkdata-----
  68           //----调用相关子程序如下----------
  69           //---- Delay();, Delay_10us();,DHT11_ReadValue(); 
  70           //--------------------------------
  71          
  72          void DHT11_ReadTempAndHumi(void)
  73          {
  74   1        uchar value;
  75   1        
  76   1        //主机拉低18ms 
  77   1        DHT11_DATA = 0;
  78   1        Delay_100us(180);
  79   1        DHT11_DATA = 1;
  80   1        
  81   1        //总线由上拉电阻拉高 主机延时20us
  82   1        Delay_10us();
  83   1        Delay_10us();
  84   1        Delay_10us();
  85   1        Delay_10us();
  86   1        
  87   1        //主机设为输入 判断从机响应信号 
  88   1        DHT11_DATA = 1;
  89   1        //判断从机是否有低电平响应信号 如不响应则跳出，响应则向下运行   
  90   1        if(!DHT11_DATA)   //T !   
  91   1        {
  92   2          FLAG = 2;
  93   2          //判断从机是否发出 80us 的低电平响应信号是否结束  
  94   2          while((!DHT11_DATA) && FLAG++);
  95   2          FLAG = 2;
  96   2          //判断从机是否发出 80us 的高电平，如发出则进入数据接收状态
  97   2          while(DHT11_DATA && FLAG++);
  98   2          //数据接收状态   
  99   2          DHT11_ReadValue();
 100   2          RH_data_H_temp = DATA_TEMP;
 101   2          DHT11_ReadValue();
 102   2          RH_data_L_temp = DATA_TEMP;
 103   2          DHT11_ReadValue();
 104   2          T_data_H_temp = DATA_TEMP;
 105   2          DHT11_ReadValue();
 106   2          T_data_L_temp = DATA_TEMP;
 107   2          DHT11_ReadValue();
 108   2          checkdata_temp = DATA_TEMP;
 109   2          DHT11_DATA = 1;
 110   2          //数据校验 
 111   2      
 112   2          value = T_data_H_temp + T_data_L_temp + RH_data_H_temp + RH_data_L_temp;
 113   2          if(value == checkdata_temp)
 114   2          {
 115   3            RH_data_H = RH_data_H_temp;
 116   3            RH_data_L = RH_data_L_temp;
C51 COMPILER V9.52.0.0   DHT11                                                             06/02/2016 17:59:18 PAGE 3   

 117   3            T_data_H = T_data_H_temp;
 118   3            T_data_L = T_data_L_temp;
 119   3            checkdata = checkdata_temp;
 120   3          }
 121   2        }
 122   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    209    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     12       1
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
